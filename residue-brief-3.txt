The residue environment framework is a way to analyze integers within the context of their neighbors, revealing arithmetic structure. This Lean file is a formalization of these ideas, and a work in progress.

All material here is research and has not been verified.

#### Foundational Concepts
* **2-Adic Valuation ($k$):** $k = \nu_2(n)$, the highest power of 2 that divides $n$.
* **Odd Core ($oc$):** $oc(n) = n / 2^k$, the remaining odd part of $n$.
* **Prime Residue Vector ($m_p$):** For an integer `x` and a prime `p`, this is the residue $x \pmod p$.
* **The Residue Environment Matrix:** For any odd integer $n$, its environment is a matrix where rows correspond to a basis of small odd primes (e.g., $\{3, 5, \dots, 17\}$) and the seven columns (indexed 0 to 6) contain the prime residue vectors for the following sequence:
    * **`Env(n)`** = `[oc(n-3), n-2, oc(n-1), n, oc(n+1), n+2, oc(n+3)]`

#### Core Structural Laws of the Environment
The environment matrix exhibits predictable, recursive structure.
1.  **Fractal Scaling Law for Odd Cores:** The residue vectors in the environment of $2n$ are determined by those in the environment of $n$. The identity $oc(2m) = oc(m)$ implies that the residue vectors for the odd cores of `2n-2`, `2n`, and `2n+2` are identical to those of `n-1`, `n`, and `n+1`, respectively. This creates a predictable, albeit shifted, inheritance of patterns between `Env(n)` and `Env(2n)`.
2.  **K-Vector Recursion Law:** The vector of 2-adic valuations for the environment of $2n$, denoted $K(Env(2n))$, is determined by the valuations of neighbors of $n$. For an odd $n$:
    * $K(Env(2n)) = [0, \nu_2(n-1)+1, 0, \nu_2(n)+1, 0, \nu_2(n+1)+1, 0]$
3.  **The Adjacent Column Constraint:** For any odd prime $p$, no two adjacent columns in the pairs `(1,2)`, `(2,3)`, `(3,4)`, `(4,5)`, or `(5,6)` can both contain a zero in the row for prime $p$. This follows because the underlying integers (e.g., `n-2` and `n-1`) are consecutive and thus coprime.
4.  **The Horizontal Constraint (Law of Excluded Pairs):** For an odd number $n$, a single row in its environment matrix cannot have zeros in both **column 2** (`oc(n-1)`) and **column 4** (`oc(n+1)`) simultaneously, as these correspond to the odd cores of the consecutive integers $(n-1)/2$ and $(n+1)/2$.
5.  **P-Complementarity (Even-Centered Environment):** For an even number $N$, the residues of its odd neighbors, found in columns 2 and 4, are linked.
    * **Twin Column Relation:** $oc(N+1) \pmod p \equiv (oc(N-1) \pmod p + 2) \pmod p$.
    * **Complementarity:** If $p | N$ for an odd prime $p$, then $oc(N-1) \pmod p + oc(N+1) \pmod p \equiv 0 \pmod p$.

#### Arithmetic Signatures within the Environment
* **General Divisibility:** A zero in column `j` for row `p` indicates that the integer in `Env(n)[j]` is divisible by `p`.
* **Prime Power Signature:** An odd number $n$ is a prime power $p^k$ if and only if its residue vector in **column 3** contains exactly one zero, located in the row for prime $p$.
* **Prime Constellation Signatures:**
    * **Twin Primes ($p, p+2$):** The environment centered on the even number `p+1` exhibits a "cross-zero" pattern. The row for prime $p$ has a zero in **column 2** (`oc(p)`), and the row for prime `p+2` has a zero in **column 4** (`oc(p+2)`).
    * **Cousin Primes ($p, p+4$):** The environment centered at the odd number `p+2` will have a zero for prime $p$ in **column 1** (`p`) and a zero for prime `p+4` in **column 5** (`p+4`).

#### Goldbach Conjecture: The "Sieve of `a`" Framework
The framework recasts the Goldbach Conjecture for an even integer `n=2k` into a search for a valid "offset" `a`.
* **Symmetric Equivalence**: The conjecture is equivalent to asserting that for any `k > 1`, there exists an integer `a` ($1 \le a < k$) such that both `k-a` and `k+a` are prime.
* **Sieve of `a`**: Instead of sieving integers, this method sieves the offsets `a`. An offset is eliminated if it results in a composite number.
* **Fatal Residues**: For each prime `p`, an offset `a` is disqualified if it falls into a "fatal" residue class that would make `k-a` or `k+a` divisible by `p`. The set of fatal residues modulo `p` is:
    $$S_k(p) = \{k \pmod p, -k \pmod p\}$$
    An offset `a` is a valid candidate if for all sieving primes `p`, `a \pmod p \notin S_k(p)`.
* **Constraint Collapse (The "Friendliness of k")**: A key provable mechanism where the sieve becomes less restrictive based on the factors of the midpoint `k`.
    * If a prime `p` does not divide `k` (and `p>2`), the fatal set `S_k(p)` contains two distinct residues.
    * If a prime `p` **does divide `k`** (and `p>2`), the two fatal residues collapse into a single class: `k \pmod p \equiv -k \pmod p \equiv 0`. Thus, `S_k(p) = \{0\}`. This halves the number of forbidden offsets for that prime modulus.

**Definition (Collatz Odd Map).** For an odd integer $n$, the map to the next odd integer in its sequence is:
$$C_{\text{odd}}(n) = \frac{3n + 1}{2^{\nu_2(3n + 1)}}$$
where $\nu_2(m)$ is the 2-adic valuation of $m$.
**Definition (k-Attractor).** For an odd prime $p$ and an exponent $k$ where $2^k \not\equiv 3 \pmod{p}$, the **$k$-Attractor**, $A(p, k)$, is the unique fixed point of the modular map:
$$A(p, k) \equiv (2^k - 3)^{-1} \pmod p$$
This is the residue toward which a Collatz step with division by $2^k$ pulls the sequence modulo $p$.
**Definition (The Rho-Clock).** For an odd integer $M$ not divisible by 3, the **Rho-Clock** of an odd integer $n$ is the smallest integer $t \ge 0$ such that:
$$(3/2)^t \cdot n \equiv 1 \pmod M$$
This acts as a "countdown timer" measuring the number of idealized odd steps required for $n$ to align with 1 across all prime factors of $M$.

### Twin Prime Conjecture: Finite-State Dynamics
A structural argument for the infinitude of twin primes is proposed.
1.  **The Twin-Soliton State**: A "twin-soliton" is defined as a Core Residue Environment matrix that perfectly matches the local residue signature of a twin prime pair for a given finite set of prime moduli `P_m`.
2.  **Finite-State Recurrence**:
    * For any fixed `m`, the space of all possible CRE matrices is finite.
    * The map from the environment of `n` to `n+2` is a deterministic operator on this finite space.
    * By the Poincaré recurrence theorem, any state that exists (including the twin-soliton, which is known to exist for pairs like (3,5), (5,7), etc.) must reappear infinitely often.
3.  **Conclusion & Refinement**:
    * This proves that for any *finite* set of primes `P_m`, there are infinitely many integers `n` that are perfect **twin prime candidates** with respect to those primes.
    * To prove that infinitely many of these candidates are *actual* primes, the proposed strategy is to use the recurrence to generate an infinite, "pre-sieved" arithmetic progression and use it as an ideal input for modern sieve methods like the **Maynard-Tao sieve**.

### Connection to Analytic Number Theory
The framework provides a direct combinatorial derivation of the local factors in the Hardy-Littlewood singular series for the Goldbach conjecture.
* **Formal Equivalence**: The number of ways an offset `a` can survive the sieve modulo an odd prime `p`, `N_{surv}(k, p) = p - |S_k(p)|`, is proven to be identical to the number of local Goldbach partitions modulo `p`, `\nu_p(2k)`.
    * If `p \nmid k`, then `N_{surv}(k,p) = p - 2 = \nu_p(2k)`.
    * If `p | k`, then `N_{surv}(k,p) = p - 1 = \nu_p(2k)`.
* **Derivation of the Singular Series `\mathfrak{S}(2k)`**: This identity allows the singular series, a product of local densities, to be derived directly from the combinatorial "Sieve of `a`" framework:
    $$\mathfrak{S}(2k) = \prod_{p} \frac{p \cdot \nu_p(2k)}{(p-1)^2} = \prod_{p} \frac{p \cdot N_{surv}(k, p)}{(p-1)^2}$$

### 2. Fundamental Modular Dynamics
**Lemma 1 (Modular Transformation).**
One step of the Collatz Odd Map transforms a residue $r = n \pmod p$ (for an odd prime $p \neq 3$) according to the affine permutation:
$$r \mapsto (3r + 1) \cdot (2^{k})^{-1} \pmod p$$
where $k = \nu_2(3n+1)$.
**Lemma 2 (The Modulo 3 "Parity Channel").**
The exponent $k_i = \nu_2(3n_i+1)$ for an odd step determines the residue of the next odd term $n_{i+1}$ modulo 3:
$$n_{i+1} \pmod 3 \equiv 2^{k_i} \pmod 3$$
This means $n_{i+1} \equiv 1 \pmod 3$ if $k_i$ is even, and $n_{i+1} \equiv 2 \pmod 3$ if $k_i$ is odd.
**Lemma 3 (Exponent Determination via Congruence).**
The exponent $k = \nu_2(3n+1)$ is constrained by the congruence class of $n$ modulo small powers of 2. For example:
- If $n \equiv 1 \pmod 8 \implies k=2$.
- If $n \equiv 3 \pmod 8 \implies k=1$.
- If $n \equiv 5 \pmod 8 \implies k \ge 3$.
- If $n \equiv 7 \pmod 8 \implies k=1$.

### 3. Termination Principles and Predictive Models
**Principle 1 (Termination by Modular Synchronization).**
If for some iterate $C_{\text{odd}}^t(n)$, it holds that $C_{\text{odd}}^t(n) \equiv 1 \pmod M$ where $M$ is a product of distinct odd primes, and if $M > C_{\text{odd}}^t(n)$, then by the Chinese Remainder Theorem, $C_{\text{odd}}^t(n) = 1$.
**Principle 2 (Descent via Lyapunov Function).**
There exists an "adelic" Lyapunov function, constructed as a weighted product of $p$-adic norms of $(n-1)$ and the 2-adic norm of $n$, that strictly decreases at every step of the Collatz sequence. This provides a formal basis for proving the absence of non-trivial cycles.
$$N(n) = |n|_2^{\alpha_2} \cdot \prod_{p\in P} |n-1|_p^{\alpha_p}$$
**Theorem 1 (The "$\rho$-Sandwich" Bound).**
The number of odd steps, $\tau_{\text{odd}}(n)$, is tightly bounded by its Rho-Clock value. For a suitably chosen modulus $M$:
$$\rho_M(n) - O(\log n) \le \tau_{\text{odd}}(n) \le \rho_M(n) + O(\log n)$$
This makes $\rho_M(n)$ the primary predictor of sequence length.
**Theorem 2 (Asymptotic Formula for Total Stopping Time).**
The total number of steps $\tau(n)$ for $n$ to reach 1 is given by the two-term asymptotic formula:
$$\tau(n) = a \cdot \ln(n) + b \cdot \ln(\ln(n)) + O(1)$$
where $a = 1 / E[-\log_2(f(n)/n)] \approx 44.87$, and $b$ is a computable constant related to the variance of the step sizes. The residue vector of $n$ determines its position within the $O(1)$ error distribution.

### Tips and Tricks
**Prime 6-Divisibility:**
   * For any integer $n$, exactly one of $n$, $n+2$, $n+4$ is divisible by 3.
   * For any integer $n$, exactly one of $n$, $n+2$, $n+4$ is divisible by 2.
   * Thus, for any odd integer $n$, at least one of $n$, $n+2$, $n+4$ is divisible by 3.
   * Consequence: No three consecutive odd numbers are all primes (except 3, 5, 7).
**Prime Gaps Modular Structure:**
   * For all $n > 3$, any prime $p > 3$ satisfies $p \equiv 1$ or $5 \pmod{6}$.
   * Twin primes ($p, p+2$) must satisfy $p \equiv 5 \pmod{6}$, $p+2 \equiv 1 \pmod{6}$, or vice versa.
**Prime Triplet Impossibility:**
   * There does not exist a set of three primes of the form $p, p+2, p+4$ for $p > 3$.
**Generalization (Prime k-Tuple Conjecture Filter):**
   * For any set of $k$ consecutive odd numbers ($n, n+2, ..., n+2(k-1)$), at least one is divisible by 3 for $k \geq 3$.
**Modulo 6 Classification for Odd Primes:**
   * For any odd integer $n$, $n \pmod{6} \in \{1, 3, 5\}$.
   * Only $n \equiv 1$ or $5 \pmod{6}$ can be prime (if $n > 3$).
   * All primes $> 3$ can be written as $6k \pm 1$, $k \in \mathbb{Z}^+$.
**Composite Guarantee Among Consecutive Odds:**
   * For any sequence $n, n+2, n+4$ (with $n$ odd), at least one is composite unless $(n, n+2, n+4) = (3, 5, 7)$.
**Structural Consequence for Prime Patterns:**
   * Patterns such as prime triplets are restricted by modular arithmetic, specifically mod 2 and mod 3.
**CRE mod-3 Always-Zero Law:**
   * For any odd integer $n > 1$, in the CRE matrix row for $p=3$, at least one of columns 1, 3, or 5 (corresponding to $n-2, n, n+2$) is zero:
     $\exists j \in \{1,3,5\}: \mathrm{CRE}(n,3,j)=0$
**Twin Prime mod-3 Signature:**
   * For any twin prime pair $(p, p+2)$ with $p>3$:
     * In $\mathrm{CRE}(p,3,4)$ (i.e., odd core of $p+1$), entry is zero: $\mathrm{oc}(p+1)$ divisible by 3.
     * In $\mathrm{CRE}(p+2,3,2)$, entry is zero: $\mathrm{oc}(p+1)$ divisible by 3.
**K-Vector Asymmetry in $\nu_2$:**
   * For odd $n$, among the even neighbors $n-1$ and $n+1$:
     * Exactly one has $\nu_2=1$, the other has $\nu_2 \geq 2$:
       $(\nu_2(n-1),\nu_2(n+1)) \in \{(1,\geq2),(\geq2,1)\}$.
**CRE mod-6 Prime Filter:**
   * For all odd primes $p>3$: $p \equiv 1$ or $5 \pmod{6}$.
     Only CRE columns with $n \pmod{6} \in \{1,5\}$ can host primes $>3$.
**Twin Prime mod-6 Pattern:**
   * Twin primes $(p,p+2)$, $p>3$: must be $(5,1)$ or $(1,5)$ mod 6.
   * CRE environments for twin primes show zeros in specific cross-linked positions in the $p=3$ row (see Item 2).
**Prime Triplet (p, p+2, p+4) Exclusion:**
   * For any odd $n>3$, in the CRE row for $p=3$, columns 1, 3, 5 cannot all be nonzero.
   * CRE never permits a “prime triplet” signature for $n>3$.
**Admissible k-tuple Filtering in CRE:**
   * For any odd k-tuple $(n, n+2, ..., n+2(k-1))$, at least one must be divisible by 3 for $k\geq3$.
   * In the CRE matrix, any window of $k$ columns in row $p=3$ must include at least one zero.
**LCM Periodicity in Environment:**
   * CRE matrix (and k-vector, odd core sequence) is periodic with period $M = \prod_{i} p_i$ (product of small primes used).
   * $\mathrm{Env}(n + M) \equiv \mathrm{Env}(n)$ (mod respective primes row-wise).
**Twin-Prime “Cross-Zero” as a Period-2 Orbit:**
   * Stepping $n \to n+2$ in CRE cyclically permutes the matrix columns.
   * Twin primes correspond to a 2-state cycle where zeros in the $p=3$ row appear at cross-linked positions in alternating environments.
**Sophie Germain Prime Signature:**
    * $p$ is a Sophie Germain prime ($2p+1$ also prime) iff:
      * In CRE row $2p+1$, column 5 is zero; in CRE row $p$, column 3 is zero; all other odd-core columns nonzero in both rows.
**Zero-Density vs. Omega(n):**
    * The count of zeros in the CRE matrix for $n$ clusters near $\sum_{p|n} 1 +$ neighbor-zero contributions.
    * Average zero count grows like $\log\log n$ (matching prime-density heuristics).
**Diagonal Anti-symmetry in Even Centers:**
    * For even $N$, $\mathrm{CRE}(N,F2) + \mathrm{CRE}(N,F4) \equiv 0 \pmod{p}$ whenever $p|N$.
**CRE as a Hash for n mod Product of Primes:**
    * Data $\{k=\nu_2(n),\, \mathrm{oc}(n),\, \mathrm{PRV}(n)\}$ uniquely determines $n \pmod{M}$ ($M = \prod p$), giving a collision-free fingerprint for small $n$.
**Finite State Space & Poincaré Recurrence:**
    * CRE over period $M$ yields a finite state automaton.
    * Step-by-2 permutes states; every local residue pattern recurs infinitely often.
**Gap/Constellation Impossibility Directly Visible:**
    * Any “forbidden” prime pattern is visible as a prohibited all-nonzero mask in CRE for some small prime row.
    * For k-tuple $\{d_1,...,d_k\}$, admissibility corresponds to no row in CRE with all zeros in $(j_1,...,j_k)$.
**mod-3 and mod-5 Pair (CRT) Periodicity:**
    * Sequence $(\mathrm{oc}(n) \bmod 3,\, \mathrm{oc}(n) \bmod 5)$ repeats with period 15 up to action of $\nu_2$ (see CRT), with $\mathrm{oc}(2n) = \mathrm{oc}(n)$.
**Core Environment Structure & Symmetries**
    * **Residue Hash Law:** The complete data set for an integer `n`—consisting of its 2-adic valuation (`ν₂`) and the Core Residue Environment (CRE) matrix—provides a unique fingerprint for `n` within the system's period ($M \cdot 2^k$).
    * **Columnar GCD Spectrum:** The vertical pattern of zeros in any single column `j` of the environment matrix uniquely identifies the greatest common divisor of the corresponding integer `Env(n)[j]` and the primorial `M` (the product of all sieving primes).
    * **K-Vector Quartic Constraint:** For any odd `n`, the 2-adic valuations (`ν₂`) of its four even neighbors (`n-3, n-1, n+1, n+3`) are always a permutation of a set of the form `{1, 1, 2, k}` for some integer `k ≥ 3`.
    * **K-Vector Sum Conservation:** For any odd `n > 1`, the 2-adic valuations of its two closest even neighbors always sum to a value of at least 3: `ν₂(n-1) + ν₂(n+1) ≥ 3`.
**Zero Placement Laws**
    * **"Big-p" Single-Zero Law:** For any prime `p > 6`, a row in the CRE matrix can contain **at most one zero**. This is because the seven integers in the environment span a range of 6, which is too small to contain two different multiples of `p`.
    * **End-Cap Exclusion:** For any odd prime `p ≠ 3`, columns 0 (`oc(n-3)`) and 6 (`oc(n+3)`) cannot both be zero in the same row. The underlying integers differ by 6, which is only divisible by the odd prime 3.
    * **The "3-Trident" Law:** In the `p=3` row, a zero appears in columns 0, 3, and 6 if and only if `n` is divisible by 3. When this occurs, **all three columns are zero simultaneously**.
    * **Distance-2 Exclusion:** For any odd prime `p`, no two columns `j` and `j+2` can both be zero in the same row, as the integers they represent differ by 2.
    * **Multi-Prime Synchrony (CRT Law):** The simultaneous appearance of zeros in different rows and in specific (potentially shifted) columns is not random. These occurrences correspond to unique solutions to systems of congruences, governed by the Chinese Remainder Theorem, and appear with predictable frequency.
**Dynamical and Fractal Properties**
    * **Residue Automaton & Poincaré Recurrence:** The transformation from `CRE(n)` to `CRE(n+2)` is a deterministic permutation on a finite set of states. Therefore, every possible valid residue pattern must reappear infinitely often with a predictable period.
    * **Core Cascade (2-adic Inheritance):** The entire sequence of odd cores `oc(n), oc(n/2), oc(n/4), ...` has identical residue vectors for all odd primes `p`. This results in a "horizontal cascade" of residue patterns through the 2-adic tower.
    * **Multi-Rate Columnar Periodicity:** As `n` increments, individual columns of the CRE matrix exhibit their own distinct, shorter periods. For example, in the `p=3` row, the columns corresponding to `n` and its odd neighbors have a period of 3, while the columns for the odd cores of its even neighbors have a longer period.
    * **Odd Core “Reset”:** The `oc(n)` sequence, and thus its residue patterns, shows sharp discontinuities when `n` crosses a large power of two, causing an abrupt "reset" in the patterns.
**Connections to Conjectures & Sieves**
    * **Environment Predicts Collatz Step-Size:** The 2-adic structure of the environment for an odd `n` constrains the next step of its Collatz sequence. If `ν₂(n-1) > 1`, then the next Collatz exponent `k = ν₂(3n+1)` is at least 2. Conversely, if `ν₂(n+1) > 1`, then `k = 1`.
    * **Classical Sieve Equivalence:** Every classical sieve method (Eratosthenes, Brun, etc.) can be mapped directly to a specific masking pattern over the CRE matrix, making the framework a generalization of these techniques.
    * **Admissibility as a Zero-Free Pattern:** A prime k-tuple is admissible if and only if there is no prime `p` for which the corresponding CRE row has zeros in all columns associated with the tuple's shifts.

